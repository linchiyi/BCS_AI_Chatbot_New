# 修正 OAuth 403 錯誤：加入測試使用者

## 問題
```
已封鎖存取權：「模擬鼻咽癌病人聊天機器人」未完成 Google 驗證程序
發生錯誤 403： access_denied
```

## 解決方法：加入測試使用者

### 步驟 1：前往 OAuth 同意畫面

1. 開啟 [Google Cloud Console](https://console.cloud.google.com/)
2. 選擇你的專案
3. 左側選單：**API 和服務** → **OAuth 同意畫面**

### 步驟 2：設定應用程式資訊（如果還沒設定）

1. **使用者類型**：選擇 **外部** (External)
2. 點擊 **建立**
3. 填寫必要資訊：
   - **應用程式名稱**：模擬鼻咽癌病人聊天機器人
   - **使用者支援電子郵件**：你的 email 
   - **開發人員聯絡資訊**：你的 email
4. 點擊 **儲存並繼續**

### 步驟 3：設定範圍 (Scopes)

1. 點擊 **新增或移除範圍**
2. 搜尋並選擇：
   - `https://www.googleapis.com/auth/drive.file`
3. 點擊 **更新**
4. 點擊 **儲存並繼續**

### 步驟 4：⭐ **加入測試使用者** ⭐

這是最關鍵的步驟！

1. 在 **測試使用者** 區塊
2. 點擊 **+ 新增使用者 (ADD USERS)**
3. 輸入你的 Google 帳號：
   ```

   ```
4. 點擊 **新增**
5. 點擊 **儲存並繼續**

### 步驟 5：完成設定

1. 檢查摘要頁面
2. 點擊 **返回資訊主頁**
3. 確認狀態顯示：**測試中** (Testing)

## 重新測試

完成上述設定後，重新執行：

```bash
cd ~/BCS_AI_Chatbot_with_Evaluation
source .venv/bin/activate

# 刪除舊的 token（如果有）
rm -f token.pickle

# 重新測試
python google_drive_utils.py
```

這次應該會成功授權！

## 視覺化步驟

```
Google Cloud Console
└── API 和服務
    └── OAuth 同意畫面
        ├── 1️⃣ 應用程式資訊
        │   └── 填寫應用程式名稱、email
        ├── 2️⃣ 範圍
        │   └── 選擇 drive.file
        ├── 3️⃣ 測試使用者 ⭐
        │   └── 新增 linqiyi0071@gmail.com
        └── 4️⃣ 摘要
            └── 確認設定
```

## 其他可能加入的測試使用者

如果有其他帳號需要使用，也在步驟 4 加入：
```
user1@example.com
user2@example.com
...（最多 100 個測試使用者）
```

## 注意事項

- **測試模式限制**：最多 100 個測試使用者
- **正式發布**：如果要開放給所有人使用，需要提交 Google 驗證（需要隱私權政策等文件）
- **目前測試模式已足夠**：對於內部使用的工具，測試模式完全夠用

## 完成後的狀態

OAuth 同意畫面應該顯示：
```
發布狀態：測試中
測試使用者：1 位使用者
```

---

